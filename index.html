<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –°–æ–≤–µ—Ç–Ω–∏–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #888888);
            --btn-color: var(--tg-theme-button-color, #2481cc);
            --btn-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }

        body {
            font-family: sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 16px;
            margin: 0;
        }

        .header h1 { margin: 0; font-size: 22px; text-align: center; }
        .header p { text-align: center; color: var(--hint-color); font-size: 14px; margin-top: 5px; }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        .hint { font-size: 12px; color: var(--hint-color); margin-top: 2px; }

        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc; /* Fallback */
            border: 1px solid var(--hint-color);
            border-radius: 8px;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus { outline: 2px solid var(--btn-color); }

        .btn-calc {
            width: 100%;
            padding: 14px;
            background-color: var(--btn-color);
            color: var(--btn-text-color);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-bg);
            display: none;
        }

        .res-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .res-val { font-weight: bold; }
        
        .alert-danger { color: #ff3b30; font-weight: bold; text-align: center; margin-top: 10px; }
        .alert-success { color: #34c759; font-weight: bold; text-align: center; margin-top: 10px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üí∏ –§–∏–Ω. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</p>
    </div>

    <div class="input-group">
        <label>üìÖ –î–Ω–µ–π –¥–æ –¥–µ–Ω–µ–≥:</label>
        <input type="number" id="days" value="30" placeholder="30">
    </div>

    <div class="input-group">
        <label>1Ô∏è‚É£ –î–æ—Ö–æ–¥ (–≤—Å–µ –¥–µ–Ω—å–≥–∏ —Å–µ–π—á–∞—Å):</label>
        <input type="number" id="income" placeholder="0">
    </div>

    <div class="input-group">
        <label>2Ô∏è‚É£ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏:</label>
        <input type="number" id="fixed" placeholder="0">
        <div class="hint">–ê—Ä–µ–Ω–¥–∞, –ñ–ö–•, —Å–≤—è–∑—å</div>
    </div>

    <div class="input-group">
        <label>3Ô∏è‚É£ –ö—Ä–µ–¥–∏—Ç—ã / –î–æ–ª–≥–∏:</label>
        <input type="number" id="debts" placeholder="0">
    </div>

    <div class="input-group">
        <label>4Ô∏è‚É£ –í –∫–æ–ø–∏–ª–∫—É:</label>
        <input type="number" id="savings" placeholder="0">
    </div>

    <div class="input-group">
        <label>5Ô∏è‚É£ –ï–¥–∞ –∏ –±—ã—Ç (–Ω–∞ –≤–µ—Å—å —Å—Ä–æ–∫):</label>
        <input type="number" id="groceries" placeholder="0">
    </div>

    <button class="btn-calc" onclick="calculate()">üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

    <div id="result" class="result-box"></div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    tg.MainButton.setText("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏");
    tg.MainButton.setParams({ color: tg.themeParams.button_color || "#2481cc" });

    function calculate() {
        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
        let days = parseFloat(document.getElementById('days').value) || 1;
        if (days < 1) days = 1;

        let income = parseFloat(document.getElementById('income').value) || 0;
        let fixed = parseFloat(document.getElementById('fixed').value) || 0;
        let debts = parseFloat(document.getElementById('debts').value) || 0;
        let savings = parseFloat(document.getElementById('savings').value) || 0;
        let groceries = parseFloat(document.getElementById('groceries').value) || 0;

        // –†–∞—Å—á–µ—Ç
        let mustSpend = fixed + debts;
        let netLifeMoney = (income - mustSpend) - savings;
        let freeMoney = netLifeMoney - groceries;
        
        let dailyTotal = netLifeMoney / days;
        let dailyFun = freeMoney / days;
        let hasDeficit = freeMoney < 0;

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        let html = `<div style="font-weight:bold; margin-bottom:10px; font-size:16px;">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>`;
        html += `<div class="res-row"><span>–í—Å–µ–≥–æ:</span> <span class="res-val">${income} ‚ÇΩ</span></div>`;
        html += `<div class="res-row"><span>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:</span> <span class="res-val">${mustSpend} ‚ÇΩ</span></div>`;
        
        if (hasDeficit) {
            html += `<div class="alert-danger">‚ö†Ô∏è –ù–ï–•–í–ê–¢–ö–ê: ${Math.abs(freeMoney)} ‚ÇΩ</div>`;
            html += `<div style="font-size:12px; text-align:center;">–ë–æ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</div>`;
        } else {
            html += `<hr style="opacity:0.2">`;
            html += `<div class="res-row"><span>–í –¥–µ–Ω—å (–í—Å–µ–≥–æ):</span> <span class="res-val">${Math.round(dailyTotal)} ‚ÇΩ</span></div>`;
            html += `<div class="res-row"><span>–ù–∞ "–ö–∞–π—Ñ":</span> <span class="res-val" style="color:var(--btn-color)">${Math.round(dailyFun)} ‚ÇΩ</span></div>`;
            html += `<div class="alert-success">‚úÖ –ë—é–¥–∂–µ—Ç –≤ –ø–æ—Ä—è–¥–∫–µ!</div>`;
        }

        document.getElementById('result').innerHTML = html;
        document.getElementById('result').style.display = 'block';

        // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
        tg.MainButton.show();
        tg.MainButton.onClick(function() {
            let data = {
                days: days,
                income: income,
                fixed: fixed,
                debts: debts,
                savings: savings,
                groceries: groceries,
                daily_total: dailyTotal,
                daily_fun: dailyFun,
                has_deficit: hasDeficit // –í–∞–∂–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –±–æ—Ç–∞
            };
            tg.sendData(JSON.stringify(data));
        });
    }
</script>
</body>
</html>
